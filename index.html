<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Audio Player</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .tracklist label { display: block; margin: 5px 0; }
        audio { width: 100%; margin-top: 10px; }
        button { font-size: 16px; padding: 10px 15px; cursor: pointer; margin: 5px; }
        #playlistDisplay { font-size: 16px; }
        .playing { font-weight: bold; color: green; }
    </style>
</head>
<body>
    <h2>Enhanced Music Player</h2>
    <h3>Select Tracks to Create a Playlist</h3>
    <div class="tracklist">
        <label><input type="checkbox" value="song1.mp3"> Song 1</label>
        <label><input type="checkbox" value="song2.mp3"> Song 2</label>
        <label><input type="checkbox" value="song3.mp3"> Song 3</label>
    </div>
    
    <button onclick="togglePlaylist()">Generate/Clear Playlist</button>
    <button onclick="toggleShuffle()">Shuffle: <span id="shuffleStatus">OFF</span></button>
    
    <h3>Now Playing:</h3>
    <audio id="audioPlayer" controls>
        Your browser does not support the audio element.
    </audio>
    <button onclick="nextTrack()">Next</button>
    
    <h3>Playlist:</h3>
    <ul id="playlistDisplay"></ul>
    
    <script>
        let playlist = [], originalPlaylist = [], currentIndex = 0, shuffleMode = false;
        let audioPlayer = document.getElementById("audioPlayer");
        
        function togglePlaylist() {
            if (playlist.length > 0) {
                clearPlaylist();
            } else {
                generatePlaylist();
            }
        }
        
        function generatePlaylist() {
            playlist = [];
            originalPlaylist = [];
            currentIndex = 0;
            document.querySelectorAll('input[type="checkbox"]:checked').forEach((checkbox) => {
                let track = { url: checkbox.value, name: checkbox.parentElement.innerText.trim() };
                playlist.push(track);
                originalPlaylist.push(track);
            });
            if (playlist.length > 0) {
                updatePlaylistDisplay();
                playTrack(0);
                window.scrollTo({ top: document.getElementById("audioPlayer").offsetTop, behavior: "smooth" });
            } else {
                alert("Please select at least one track.");
            }
        }
        
        function clearPlaylist() {
            playlist = [];
            originalPlaylist = [];
            currentIndex = 0;
            document.getElementById("playlistDisplay").innerHTML = "";
            audioPlayer.src = "";
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
        }
        
        function updatePlaylistDisplay() {
            let display = document.getElementById("playlistDisplay");
            display.innerHTML = "";
            playlist.forEach((track, index) => {
                let li = document.createElement("li");
                li.textContent = track.name;
                if (index === currentIndex) li.classList.add("playing");
                display.appendChild(li);
            });
        }
        
        function playTrack(index) {
            if (playlist.length === 0) return;
            currentIndex = index;
            audioPlayer.src = playlist[index].url;
            audioPlayer.play().catch(console.error);
            updatePlaylistDisplay();
        }
        
        function nextTrack() {
            if (playlist.length === 0) return;
            currentIndex = (currentIndex + 1) % playlist.length;
            playTrack(currentIndex);
        }
        
        function toggleShuffle() {
            shuffleMode = !shuffleMode;
            document.getElementById("shuffleStatus").textContent = shuffleMode ? "ON" : "OFF";
            playlist = shuffleMode ? [...playlist].sort(() => Math.random() - 0.5) : [...originalPlaylist];
            updatePlaylistDisplay();
        }
        
        audioPlayer.addEventListener("ended", nextTrack);
    </script>
</body>
</html>
